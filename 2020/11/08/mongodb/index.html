<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>mongodb | 啵A&amp;博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="连接mongo –host&#x3D;127.0.0.1 –prost&#x3D;27017克隆数据库db.clonedatabase(“127.0.0.1”)复制指定主机指定数据库到某数据库db.copyDatabase(‘mydb’,’temp’,’127.0.0.1’)查看所有数据库show dbsshow databases查看当前数据库[show] db&#x2F;db.getname显示当前db状态db.stats">
<meta property="og:type" content="article">
<meta property="og:title" content="mongodb">
<meta property="og:url" content="http://yoursite.com/2020/11/08/mongodb/index.html">
<meta property="og:site_name" content="啵A&amp;博客">
<meta property="og:description" content="连接mongo –host&#x3D;127.0.0.1 –prost&#x3D;27017克隆数据库db.clonedatabase(“127.0.0.1”)复制指定主机指定数据库到某数据库db.copyDatabase(‘mydb’,’temp’,’127.0.0.1’)查看所有数据库show dbsshow databases查看当前数据库[show] db&#x2F;db.getname显示当前db状态db.stats">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-11-08T08:53:46.000Z">
<meta property="article:modified_time" content="2020-11-08T17:24:33.590Z">
<meta property="article:author" content="啵A">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="啵A&amp;博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">啵A&amp;博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-mongodb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/08/mongodb/" class="article-date">
  <time datetime="2020-11-08T08:53:46.000Z" itemprop="datePublished">2020-11-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mongodb
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>连接<br>mongo –host=127.0.0.1 –prost=27017<br>克隆数据库<br>db.clonedatabase(“127.0.0.1”)<br>复制指定主机指定数据库到某数据库<br>db.copyDatabase(‘mydb’,’temp’,’127.0.0.1’)<br>查看所有数据库<br>show dbs<br>show databases<br>查看当前数据库<br>[show] db/db.getname<br>显示当前db状态<br>db.stats()<br>查看当前db连接的服务器地址<br>db.getmongo()<br>选择，隐式创建数据库<br>use db_name<br>删除数据库<br>db.dropDatabase()<br>恢复数据库<br>db.repairDatabase())<br>设置记录profiling (0=off,1=slow,2=all)<br>db.setProfilingLevel(1)<br>查看profiling<br>show profile<br>拷贝数据库<br>db.copyDatabase(‘mail_addr’,’mail_addr_tmp’)</p>
<p>用户<br>添加或修改用户密码<br>db.addUser(“xxx”,’pwd’)<br>db.createUser({“user”:”账号”,”pwd”:”密码”,”roles”:[{role:”角色”,db:”所属数据库”}]})<br>查看用户列表<br>db.system.users.find()<br>查看所有用户<br>show users<br>用户认证<br>db.auth(“xxx”,’pwd’)<br>删除用户<br>db.removeUser(“xxx”)</p>
<p>集合<br>创建<br>db.creatcollection(‘collection_name’)<br>db.collection_name.insert()<br>查看<br>show collections<br>show tables<br>db.collection_name.dataSize() 数据空间大小<br>db.collection_name.count() 文档数目<br>删除<br>db.collection_name.drop()<br>改名<br>db.collection_name.renamecollection(‘new_name’)<br>创建索引<br>db.collection_name.ensureIndex({k:v}/{k:1})<br>删除索引<br>db.collection_name.dropIndex([{k:v}])<br>查看集合索引<br>db.collection_name.getIndexes()</p>
<p>文档<br>增<br>db.collection_name.insert()<br>db.collection_name.save()<br>删<br>db.collection_name.remove({条件},是否删除一条)<br>改<br>db.collection_name.update({条件},{操作符:{更新字段}},{upsert:ture,multi:ture})<br>db.collection_name.updatemany({条件},{操作符:{更新字段}}, false, ture)<br>$inc:递归该字段值<br>$set:设置字段值<br>$unset:删除字段<br>$rename:重命名字段<br>$push:增加一个对象到数组尾部<br>$pushAll:增加多个对象到数组尾部<br>$pop:从数组尾部删除一个对象<br>$pull:如果匹配指定的值，删除对应对象<br>$pullAll:如果匹配任一值，删除对应对象<br>$addToSet:如果不存在就增加一个值到数组<br>查<br>db.collection_name.find({条件字段,不能为空,{}},{投影字段:0/1/-1})[.skip(n)/.count()/.sort({属性:1/-1})/.limit(n)]<br>db.collection_name.distinct(属性) 某属性的全集<br>db.collection_name.group({key:{条件},initial:{‘输出变量’:0},reduce:fuction (){}}) 分组<br>db.collection_name.aggregate([{管道:{表达式}},…])<br>常用管道<br>$group 文档分组 似group by<br>{$group:{_id:”$属性”/null,rs:{$sum:”$属性”}}}<br>{$group:{_id:null,total_num:{$sum:1},total_avt:{$avg:”$avg”}}}<br>$match 数据过滤 似where<br>{$match:{属性:值}}<br>$project 投影 似as<br>$sort 聚合数据排序 似order by<br>{$group:{_id:”$属性”/null,rs:{$sum:”$属性”}},$sort:{rs:1}}<br>$skip 跳过文档数 类似skip<br>$limit 返回文档数 类似limit<br>$lookup 左外连接 似left out join<br>$unwind 将列表展开<br>{$unwind:’$score’}<br>常用表达式<br>$sum 总和 $sum:1同count表示统计<br>$avg 平均<br>$min 最小值<br>$max 最大值<br>$map<br>$reduce<br>$eq 等于<br>下列操作符</p>
<p>db.collection_name.find({操作符})<br>常用操作符<br>$lt小于<br>{‘age’: {‘$lt’: 20}}<br>$gt大于<br>{‘age’: {‘$gt’: 20}}<br>$lte小于等于<br>{‘age’: {‘$lte’: 20}}<br>$gte大于等于<br>{‘age’: {‘$gte’: 20}}<br>$ne不等于<br>{‘age’: {‘$ne’: 20}}<br>$in在范围内<br>{‘age’: {‘$in’: [20, 23]}}<br>$nin不在范围内<br>{‘age’: {‘$nin’: [20, 23]}}<br>$regex匹配正则表达式<br>{‘name’: {‘$regex’: ‘^M.*’}}name以M开头<br>$exists属性是否存在<br>{‘name’: {‘$exists’: True}}name属性存在<br>$type类型判断<br>{‘age’: {‘$type’: ‘int’}}age的类型为int<br>$mod数字模操作<br>{‘age’: {‘$mod’: [5, 0]}}年龄模5余0<br>$text文本查询<br>{‘$text’: {‘$search’: ‘Mike’}}text类型的属性中包含Mike字符串<br>$where高级条件查询<br>{‘$where’: ‘obj.fans_count == obj.follows_count’}自身粉丝数等于关注数<br>$or<br>{$or:[{条件1},…]}<br>$and<br>{$and:[{条件1},…]}</p>
<p>####################################<br>import pymongo</p>
<p>client = pymongo.MongoClient(host=’127.0.0.1’)<br>client = MongoClient(‘mongodb://用户名:密码@localhost:27017/数据库名’)</p>
<p>db_list = client.list_database_names()<br>print(db_list)</p>
<p>db = client.test1<br>db = client[‘test1’]<br>print(db)</p>
<p>ct = db.c3<br>collection = db[‘c3’]</p>
<p>person = {<br>     ‘name’: “c”,<br>     ‘age’: ‘2’,<br>     ‘title’: ‘very good!!!’,<br>     ‘hiredate’: datetime.datetime.now()<br>}<br>ct.insert_one(person)<br>result = ct.insert([p1, p2])<br>result = ct.insert_many([p1, p2])<br>ct.update_one({‘age’:2},{‘$set’: {‘age’: 2}})<br>ct.update_many()<br>ct.drop<br>ct.remove({“_id”: “5f618b03d43f336dbe0935f3”})</p>
<p>result = ct.find({}, {‘_id’:0})<br>results = collection.find({‘name’:’python’})<br>for result in results:<br>for i in result:<br>    print(i.get(‘age’))<br>    # print(i[‘age’])</p>
<p>results = collection.find({‘age’:{‘$gt’:20}})#条件查询<br>s = ct.find({‘age’: {‘$gt’: 20}}.sort(‘age’, -1))</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/11/08/mongodb/" data-id="ckh9e13bh0007s78p7rjw274y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/08/redis/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          redis
        
      </div>
    </a>
  
  
    <a href="/2020/11/08/cpp/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">cpp</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/08/mssql/">mssql</a>
          </li>
        
          <li>
            <a href="/2020/11/08/redis/">redis</a>
          </li>
        
          <li>
            <a href="/2020/11/08/mongodb/">mongodb</a>
          </li>
        
          <li>
            <a href="/2020/11/08/cpp/">cpp</a>
          </li>
        
          <li>
            <a href="/2020/11/08/python/">python</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 啵A<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>